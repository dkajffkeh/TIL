# 그림으로 공부하는 IT 인프라 구조
<p align="center"><img src="images/IT_infrastructure_cover.png" width="300" align="center"/></p>

---
## 1. 인프라 아키텍처를 살펴보자

##### 1.1 인프라란 무엇일까
> '기반 구조' 란 뜻으로 바탕이나 토대를 의미한다. IT 인프라도 마찬가지로 어플리케이션이 동작하고 작동하고 있는 그 기반을 의미한다.

##### 1.2 집약형과 분할형 아키텍처

> IT 인프라는 컴퓨터로 구성된다. 기본적인 구성 방식에는 집약형과 분할형 이 있다.

##### 집약형

집약형 아키텍처는 하나의 컴퓨터가 모든 트레픽에 대한 핸들링을 하나의 컴퓨터가 도맡아 하는 구조를 말한다. 장점은 구성이 매우 간단하다는 장점이 있다.
하지만 하나의 컴퓨터가 모든 일을 처리 하게 되기때문에 그 컴퓨터는 멈추지 않도록 여러 고민을 해야한다.
- 방법중의 하나는 컴퓨터를 구성하는 주요 부품을 다중화 하여 하나가 고장 나더라고 업무를 계속 할 수 있도록 분리 하는것이다. 한대의 컴퓨터라고 할 지라도
그 안에 여러 컴퓨터가 같이 있는 모습이라 할 수 있다.

***장단점 정리***

장점 
1. 한 대의 대형 컴퓨터만 있으면 되므로 구성이 간단하다.
2. 대형 컴퓨터의 리소스 관리나 이중화에 의해 안정성이 높고 고성능이다.

단점
1. 도입비용과 유지 비용이 비싸다
2. 확장성에 한계가 있다.

##### 분할형

> 여러대의 컴퓨터를 조합하여 하나의 시스템을 구축하는 구조 
> 대형 컴퓨터와 비굫해서 소형 컴퓨터 구입 비용이 압도적으로 저렴하다. 단 안정성은 한대의 컴퓨터만으로 대형컴퓨터에 미치지 못한다. 분할형 아키텍쳐는 표준OS 나 개발
> 언어를 이용하기 때문에 오픈 시스템이라고도 부른다.

***장단점***

장점
1. 낮은 비용으로 시스템을 구축할 수 있다.
2. 서버 대수를 늘릴 수 있어서 확장성이 높다.

단점
1. 대수가 늘어나면 관리 구조가 복잡해진다
2. 한 대가 망가지면 영향 범위를 최소화하기 위한 구조를 검토해야 한다.


물리 서버와 논리 서버의 차이

'서버' 라고 하는 개념은 컴퓨터에서 동작하고 있는 소프트웨어를 가리크는 경우도 있고 컴퓨터 자체 하드웨어를 가르키는 경우도 있다.

논리서버 : 웹 서버, DB서버 Web Application Server

물리서버 : IA 서버, x86서버

##### 수직 분할형 아키텍처

> 클라이언트 - 서버형은 수직 분할형의 한 예이다. 물리서버는 미들웨어 데이터베이스 등의 소프트웨어를 물리 서버 상에서 운영하고 있다. 
>이들 소프트 웨어에 클라이언트 또는 단말 이라 불리는 소형 컴퓨터가 접속해서 이용하는 형대 Client/Server CS 라고 부르기도 한다.
> CS 특징은 클라이언트 측에 전용 소프트웨어를 설치해야한다는 것이다. 

장점

1. 클라이언트 측에 많은 처리를 실행할 수 있어 소수의 서버로 다수의 클라이언트를 처리할 수 있다.

단점

1. 클라이언트 츠그이 소프트웨어 정기 업데이트가 필요하다.
2. 서버 확정성에 한계가 발생할 수 있다.

##### 3계층형 아키텍처

> 프레젠테이션 계층 애플리케이션 계층 데이터 계층 3층으로 구조로 분할 되있는 구조이다.

![img_1.png](images/3Layer.png)

> 프레젠테이션 계층

- 사용자의 입력을 받는다
- 웹 브라우저 화면을 표시한다

> 애플리케이션 계층

- 사용자 요청에 따라 업무를 처리한다.

> 데이터 계층

- 애플리케이션 계층의 요청에 따라 데이터를 입출력한다. 이 아키텍처는 모든 처리가 AP 서버나 DB 서버를 이용하지 않아도 된다. 이미지 파일및 정적파일
만 있으면 되는경우라면 웹서버만으로도 핸들링이 가능하다. 

장점
- 서버 부하 집중 개선
- 클라이언트 단말의 정기 업데이트가 불필요
- 처리 반환에 의한 서버 부하 저감

단점
- 구조가 CS구성보다 복잡하다.

##### 수평 분할형 아키텍처

![img_1.png](images/Patitioning.png)

> 수평 분할형 아키텍처는 용도가같은 서버를 늘려나가는 방식이다. 서버 대수가 늘어나면 한대가 시스템에 주는 영향력이 낮아져서 안정성이 향상된다.

단순 수평분할형 아키텍처
> 이 구성은 시스템이 둘로 분할됨으로써 시스템 전체 처리 성능을 두 배로 향상시킬 수 있다. 하지만 업데이트가 있을경우 매번 각 서버마다 업데이트를 실시해 주어야 한다.
> 서로 다른 서버 끼리 보유한 데이터도 다르기 때문에 동시에 이용할 수 없다. 주로 사용자가 있는 SNS웹 서비스에서는 사용자ID 를 기준으로 분할 하는 경우가 있다.



***장점***
- 수평으로 서버를 늘리기 떄문에 확정성이 향상된다
- 분할한 시스템이 독립적으로 운영되므로 서로 영향을 주지 않는다

***단점***
- 데이터를 일원화해서 볼 수 없다.
- 애플리케이션 업데이트는 양쪽을 동시에 해주어야한다.
- 처리량이 균등하게 분할 돼 있지 않으면 서버별 처리량에 치우침이 생긴다.

##### 공유형 아키텍처

![img_2.png](images/img_2.png)

> 서로 서버 계층간의 교환이 가능하다. 데이터 계층은 데이터 저장고의 역할도 하기 때문에 보안이 필요한 데이터가 저장되는 경우도 많다. 데이터가 각지에 흩어져
> 있는 것보다 한곳에 집중적으로 관리하는 것이 보안상 유리한 경우가 있다.

***장점***
- 수평적으로 서버를 늘리기 때문에 확장성이 향상된다.
- 분할한 시스템이 서로 다른 시스템의 데이터를 참조할 수 있다.

***단점***
- 독립성이 낮아진다
- 분할 계층간 확장성이 낮아진다

##### 지리 분할형 아키텍처

- 스텐바이형 아키텍처
> 물리 서버를 최소 두대를 준비하여 한대가 고장나면 가동중인 소프트 웨어를 다른 한대로 옮겨서 운영하는 방식이다. 이때 소프트웨어 재시작을 자동으로 하는 구조를
> 페일오버 라고한다. F/O

엑티브 스탠바이 -> 액티브 서버의 고장을 대비하여 쉬고 있는 이중화된 서버를 하나 더 배치하는 구조 이 경우 서버 고장이 없을경우 고가의 서버 자원이 놀고만 있게 된다.

## 2. 서버를 열어보자

> 서버는 Rack 이라는 것에 장착된다 랙에는 서버 이외에도 HDD 가 장착돼있는 저장소나 LAN 을 연결하기 위한 네트워크 스위치 등도 탑재돼 있다. 한 랙은 19인치 한칸에 4.5
> cm 와 같은 규격이 존재한다.

##### CPU (Central Processing Unit)

> 서버 중심에 위치해서 연산 처리를 실시한다. 명령을 받아 연산을 실행하고 그 결과를 반환한다. 명령과 데이터는 기억장치나 입출력 장치를 통해 전달된다.

##### Memory

> 메모리에 저장되는 데이터는 영구성이 없으며 서버 재시작시 휘발된다. 이런 결점에도 사용하는 이유는 CPU 에 자장되는 캐시 데이터가 너무 작아 이에 대한 커버를
> 담당한다.

##### HDD

> HDD 는 DC 나 DVD 와 같은 구조이다 이 회전 구조 떄문에 속도가 물리 법칙에 좌우 되며 메모리처럼 순식간에 액세스 할 수 없다. 이에 성능이 더 좋은 반도체 디스크
> SSD 가 등장 전기가 없어도 데이터가 사라지지 않는 구조를 갖고있다. 또한 HDD 가 많이 장착된 하드웨어를 스토리지 라고 한다. 서버와 통신시 I/O 가 발생할 경우 HDD 를 직접 참조하는것이 아닌
> 캐시를 통해 데이터를 교환한다.

##### 대역

> 대역이란 데이터 전송 능력을 말한다, 대역은 한번에 데이터를 보낼 수 있는 데이터의 폭 1초에 전송할 수 있는 횟수 x 전송 폭 으로 결정된다.

### 3계층형 시스템을 살펴보자

![img.png](images/threeLayer.png)

> 3대의 서비스는 스위치를 경유해서 연결돼 있으며 서버를 확대해서 보면 CPU 메모리 디스크 HBA 와 같은 하드웨어 부품이 나열돼 있다.


##### 프로세스와 스레드

> 프로그램을 실행하게 되면 별도의 실행 창이 열린다 이것이 프로세스나 스레드라고 불리는 것이다.
> 프로세스 및 스레드는 프로그램 실행 파일 자체가 아니라 OS상에서 실행돼어 어느 정도 족립성을 가지고 동작하는 것이다. 프로세스 및 스레드가 활동하려면 메모리 공간이 필요하다.
> OS 상에 프로세스가 로드 되면 사용자 요청을 받을 수 있게 된다. 프로세스 시작 요청이 있을경우 커널은 프로세스를 작성하여 요청 분향만큼 메모리 공간을 할당한다.
> 
> 프로그램은 서버 내부의 디스크 상에 설치가 된다. 하나의 프로세스가 동작하고 있으면 내부에서는 메모리 공간을 점유하는 스레드 하나가 동작하고 있다.
> 각 스레드는 메모리 공간을 공유하고 있으며 스레드 시작 시에 신규 메모리 공간은 필요 없지만 다른 스레드에 이상이 발생하면 영향을 받는다.
> 
> 단 프로세스간 메모리 공간을 상호 이용할 수 없는것은 아니다. 여러 프로세스가 공유 메모리 공간을 사용하게 되면 서로 데이터 교환이 가능하지만 프로세스별 독자 메모리 영역도
> 있어서 용도별로 나누어 사용한다.
>  
![img.png](images/proccessandthread.png)


##### OS 커널

> OS 에서 커널은 심장이자 뇌이며 척추다. 커널이 OS 의 본질이며 나머지는 그저 덤일 뿐 이라고 해도 과언이 아니다. OS 처리는 원칙적으로는 커널을 통해 이루어진다 커널의 역할에는
> 여러가지가 있다 총 6가지 커널이 존재한다.

1. 시스템 콜 인터페이스
    - 프로세스/스레드에서 커널로 연결되는 인터페이스다 애플리케이션이 OS를 통해서 어떤 처리를 하고 싶으면 시스템 콜이라고 하는 명령을 이용해서 커널에 명령을 내린다. 
   이 명령은 시스템 콜 인터페이스로 처음 전달된다.
    - 디스크상의 데이터를 읽고 싶거나 네트워크 통신을 하고 싶을 때 또는 새로운 프로세스를 생성하고 싶은 경우에 해당 시스템 콜을 호출하면 기능을 이용할 수 있다.
    - 데이터 읽기/쓰기는 I/O 처리라고 하며 디스크 I/O 와 네트워크 I/O 와 본질적 차이는 없다. 프로세스 관점에서는 동일한 시스템 콜이다.


2. 프로세스 관리
    - 프로세스를 관리한다 OS상에서 수십 수백 수천 개의 프로세스를 가동할 수 있다. 이에 비해 CPU 코어 수는 많아야 수십개 정도밖에 안된다.
   언제 어떤 프로세스가 어느 정도의 CPU 코어를 이용할 수 있는지 처리 우선순위를 어떻게 결정 할 것인지 등을 관리하는것이 프로세스 관리의 역할이다.
   OS에 있어서 가장 중요한 기능이라고 할 수 있다.


3. 메모리 관리
    - 메모리 영역을 관리한다 프로세스 관리는 CPU 코어를 고려했지만 메모리 관리에서는 물리 메모리 공간의 최대치를 고려한다. 프로세스가 이용하는 독립 메모리 공간을 확보 하거나
   상호 간의 참조 영역을 지키기 위해 독립성을 관리하는 등의 메모리 관리 역할을 한다. 이 기능이 없으면 각 프로세스는 자신 이외의 프로세스가 사용하고 있는 메모리 영역 범위를 파악 
   해야 하므로 애플리케이션 개발자가 메모리 영역을 그때그떄 핸들링 해야한다.
   

4. 네트워크 스택


5. 파일 시스템 관리

    - 물리 디스크에 제동된 데이터를 관리하는 기능이다. 일상에서 사용하는 문서 파일 엑셀 파일 이 이에 해당한다. 기록된 데이터는 1011011011 과 같은 숫자의 집합에 불과하다.
   구분 표시도 없을 뿐더러 그대로 사용하기는 매우 어려운 형태다. 파일 시스템 덕분에 애플리케이션은 파일 이라는 단위로 데이터를 작성하거나 삭제할 수 있다.
   

6. 장치 드라이버
    - 디스크 NIC등의 물리 장치용 인터페이스를 제공한다. NIC나 디스크는 다수의 제조사가 독자 제품을 제공하고 있다. 각각에 대응하는 애플리케이션을 개발하는 것은 현실적이지
못하기 때문에 커널은 장치 드라이버를 이용해서 그 아래에 있는 물리 장치를 은폐한다. OS 에 대응하도록 커넉을 경유해 이동한다.

> 커널은 결코 견고하지 않다. 커널의 종류에는 모놀리식 커널과 마이크로 커널이다 모놀리식은 단일형을 가리키고 마이크로는 커널에서 최소한의 기능만 제공하고 그 외기능은 
> 커널 밖에서 제공한다. 모놀리식 커널은 유닉스 계열의 OS 나 리눅스, 마이크로는 애플의 맥OS 가 있다.


#### 클라이언트 PC부터 웹 서버까지

> 클라이언트 PC로 부터 웹 서버까지

1️⃣ 웹 브라우저(Chrome, FireFox..)가 요청을 발행한다.
    
- 주소창에 http://www.naver.com 을 입력하고 엔터를 친다. 이는 www.naver.com 서버에 접속한다는 의미이다.

2️⃣ 이름을 해석(Name resolution)한다. (해당사이트가 어디에 있는지 이름을 해석하여 찾아냄.)

- 웹 브라우저는 www.naver.com 의 주소를 모른다. 하여 IP 주소 변환테이블을 참조하여 존재하지 않을경우 외부의 DNS 서버의 요청을 던진다.
DNS 서버에 호스트 명이 IP 주소로 지정돼 있는것은 이때문이다. DNS 에서 조회된 IP 주소 검색 결과가 반환된다. (아직 요청은 출발하지 않았다.) 

⭐️ 아파치 에서는 기본적으로 부모 프로세스와 자식 프로세스로 나뉘어져 있다. 자식 프로세스가 HTTP 요청을 접수 한다.
응답은 HTML 파일이라는 텍스트 데이터나 이미지 동영상 등의 바이너리 데이터로 구성된다. 이 데이터 들은 정적 데이터와 동적 데이터로 분류할 수 있다.

3️⃣ 웹 서버가 요청을 접수한다.

4️⃣ 정적컨텐츠와 동적컨텐츠를 판별한다.

5️⃣ 필요한 경로로 데이터를 액세스 한다.

> 웹 서버부터 AP 서버까지 

#### 📀 웹서버부터 AP 서버까지

1️⃣ 웹서버로부터 요청이 도착한다.

2️⃣ 스레드가 요청을 받으면 자신이 계산할 수 있는지 아니면 DB 접속이 필요한지를 판단한다.

3️⃣ DB접속이 필요하면 연결 풀에 액세스 한다.

4️⃣ ~ 5️⃣ DB서버에 요청을 던진다.

#### 💽 데이터가 필요하면 DB 서버에 접속하는 것이 일반적이지만 항상 효율적일수 없다. 갱신 빈도가 낮은 정보는 캐시로 저장해 두었다가 반환하는것이 좋다

### CDN 방식

> 대부분의 웹 시스템에서는 CDN 을 이용하고 있다. 웹시스템 특징인 -> 하나의 시스템을 수많은 사용자가 이용한다 이다. 대량의 데이터 전송에 특화된 것으로
> 전 세계에 있는 데이터 복사본을 배치하는 기술과 병렬 기술을 활용해서 처리를 효율화 하고 있다.

#### 💽AP 서버로부터 DB 까지

> DB 서버에도 다향한 소프트웨어가 존재한다. 웹 계열 시스템이서는 MySQL 이나 PostgreSQL 등이 인기 있 기업용으로는 오라클 데이터베이스 가 있다.
> 넓이를 RDBMS 밖으로 넓히면 Key-Value-Store 라 불리는 DB 도 존재한다. 

<br><br><br><br><br><br><br><br><br>

